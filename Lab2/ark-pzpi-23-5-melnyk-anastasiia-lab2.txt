МІНІСТЕРСТВО ОСВІТИ І НАУКИ УКРАЇНИ
ХАРКІВСЬКИЙ НАЦІОНАЛЬНИЙ УНІВЕРСИТЕТ РАДІОЕЛЕКТРОНІКИ


КАФЕДРА ПРОГРАМНОЇ ІНЖЕНЕРІЇ




Звіт
з лабораторної роботи № 2 з дисципліни
Аналіз та рефакторинг коду





Виконала:                                                                Перевірив:
ст. гр. ПЗПІ-23-5                				ст. викладач кафедри ПІ
Мельник Анастасія					Сокорчук Ігор Петрович

























Харків 2025


ІСТОРІЯ ЗМІН
      №      ДатаВерсія звіту      Опис змін та виправлень      1      25.12.2025      0.1      Початкова версія

      




1 ЗАВДАННЯ

1. Розробити будову програмної системи.
2. Створити UML діаграму прецедентів для серверної частини системи.
3. Створити ER діаграму даних.
4. Розробити базу даних (БД) програмної системи.
5. Створити діаграму структури БД.
6. Розробити функції роботи з БД.
7. Розробити API (REST) для взаємодії серверної частини з клієнтами.
8. Створити специфікацію розробленого API.
9. Створити програмну реалізацію розробленого API та функцій роботи з БД.
10. Перевірити роботу створеного програмного коду серверної частини системи.
11. Завантажити або оновити (при потребі) створений програмний код у GitHub репозиторій для лабораторних робіт у гілку репозиторію main.
12. Створити відеозапис тривалістю 7-9 хвилин з демонстрацією перевірки (тестування) описаної у розділі 3.1 Vision & Scope функціональності серверної частини.
13. Завантажити створений відеозапис у свій канал для облікового запису студента в домені nure.ua на YouTube. При завантаженні відеозапису обовʼязково встановити у налаштуваннях для цього відео українську мову як мову відео та мову субтитрів до відео.
14. Створити хронологічний опис (хвилина:секунда) демонстрації та додати цей опис до опису відео на YouTube.
15. Створити звіт до лабораторної роботи.
16. Вказати у звіті посилання на створений відеозапис на YouTube
17. Експортувати створений звіт у формат PDF та завантажити його на платформу dl.nure.ua
18. Експортувати увесь створений звіт у текстовий файл з кодуванням UTF-8 та записати цей файл у GitHub репозиторій для лабораторних робіт.

2 ОПИС ВИКОНАНОЇ РОБОТИ

	Програмна система реалізована як серверна частина у вигляді REST API-додатку для моніторингу стану рослин та управління доглядом за ними в офісних приміщеннях. Для розробки використано платформу Node.js та фреймворк Express.js, а як систему управління базами даних обрано PostgreSQL. Взаємодія з базою здійснюється через сучасний Drizzle ORM, що забезпечує типобезпеку (TypeScript) та ефективне виконання запитів. Аутентифікація користувачів реалізована за допомогою JWT-токенів, які передаються в заголовках HTTP-запитів, забезпечуючи захист приватних маршрутів і розмежування доступу відповідно до ролей (Адміністратор, Офіс-менеджер, Флорист, Прибиральник).
     Система складається з кількох функціональних модулів. Модуль адміністрування відповідає за управління користувачами та правами доступу. Модуль "Зеленого фонду" дозволяє керувати локаціями (офісними кімнатами), видами рослин та самими рослинами.Модуль догляду відповідає за постановку завдань (полив, удобрення), ведення журналу виконаних робіт (care_logs) та верифікацію дій персоналу.
     Для моніторингу середовища використовуються IoT-пристрої, оснащені сенсорами вологості ґрунту, температури та вологості повітря, інтенсивності освітлення, а також датчиками заряду батареї. Телеметрія від сенсорів передається через протокол MQTT на проміжний шлюз (Smart Bridge), який виконує первинну обробку, виявляє аномалії (за алгоритмом IQR) та передає відфільтровані дані на сервер через REST API. Це дозволяє оперативно реагувати на критичні зміни умов утримання рослин (наприклад, пересихання ґрунту або недостатнє освітлення).
     ER-діаграма (див. дод. Б) побудована з урахуванням нормалізації даних. Основними сутностями є: Локації (locations), Види рослин (plant_species), Рослини (plants), Користувачі (users), IoT-сенсори (iot_sensors) та їх показники (sensor_readings). Реалізовано чітку ієрархію: одна локація містить багато рослин, кожна рослина може мати прив'язаний IoT-пристрій, який генерує часовий ряд показників (зв'язок one-to-many). Також реалізовано зв'язок завдань догляду з конкретними рослинами та виконавцями.
     Фізична модель бази даних відображає точні типи даних PostgreSQL: використання UUID для первинних ключів, VARCHAR та TEXT для описових полів, NUMERIC/REAL для точних вимірювань сенсорів та TIMESTAMP WITH TIME ZONE для коректної фіксації часу подій. Широко використовуються ENUM типи для статусів (наприклад, plant_health_status, task_type), що забезпечує цілісність даних на рівні БД. Завдяки Drizzle ORM, механізм relations дозволяє ефективно отримувати складні вкладені структури, наприклад, інформацію про рослину разом із її історією показників та журналом догляду за один запит.
     Документація API інтегрована безпосередньо в код за допомогою бібліотек swagger-jsdoc та swagger-ui-express. Це дозволяє автоматично генерувати актуальну інтерактивну документацію, де описані всі ендпоінти, схеми запитів/відповідей (DTO) та методи авторизації, що значно спрощує розробку клієнтських додатків та інтеграцію з IoT-компонентами.



4 ВИСНОВКИ
     
     Розроблена програмна система забезпечує комплексний моніторинг та догляд за рослинами в офісному середовищі («EcoOffice») завдяки реалізації серверної частини у вигляді REST API-додатку на базі Node.js, Express.js та TypeScript. Використання PostgreSQL у поєднанні з Drizzle ORM дозволяє ефективно та безпечно працювати з базою даних, реалізовуючи всі операції CRUD і підтримуючи складні запити з глибокими вкладеними зв’язками між локаціями, видами рослин, сенсорами та історією догляду.
     Модульна архітектура, побудована за принципом Controller-Service-Repository, гарантує чіткий поділ відповідальностей між обробкою HTTP-запитів та бізнес-логікою, що підвищує зрозумілість та підтримуваність коду. Автоматизація процесів моніторингу, зокрема безперервний збір телеметрії (вологість ґрунту, освітлення, температура) через MQTT-шлюз та інтелектуальний аналіз аномалій, дозволяє підтримувати оптимальні умови для рослин та своєчасно сповіщати персонал про критичні зміни без необхідності постійного фізичного нагляду.
     Система реалізує гнучку рольову модель з чотирма рівнями доступу (див. дод. Б) (Адміністратор, Офіс-менеджер, Флорист, Прибиральник), що забезпечує безпечну роботу, контроль за станом зеленого фонду та ефективний розподіл завдань. Інтерактивна документація API, автоматично згенерована за допомогою Swagger, спрощує роботу розробників клієнтської частини та інтеграцію IoT-пристроїв, надаючи повний опис ендпоінтів, приклади запитів та відповідей, а також схеми даних.





ДОДАТОК А

Відеозапис

Відеозапис презентації результатів лабораторної роботи:  https://youtu.be/IsIYV78TgAw 

Хронологічний опис відеозапису:

00:00 - Привітання, представлення автора та теми роботи (Розробка REST API для EcoOffice).

00:20 - Опис технологічного стека: Node.js, Express, TypeScript, PostgreSQL, Drizzle ORM.

00:43 - Аналіз ER-діаграми (зв'язки між рослинами, сенсорами, показниками та завданнями).

01:38 - Демонстрація діаграми бази даних.

01:42 - Опис UML-діаграми прецедентів: ролі (Гість, Користувач, Персонал, Менеджер, Адмін) та їхні можливості.

02:38 - Процес запуску сервера в терміналі VS Code.

03:02 - Перевірка працездатності API через браузер та огляд Swagger документації.

03:12 - Тестування в Postman: Реєстрація нового користувача (user3) та отримання JWT-токена.

03:33 - Авторизація (Login) користувача.

03:45 - Робота з сутностями: Отримання списку рослин та локацій.

04:12 - Створення нової локації (Open Space 5) через POST-запит.

04:30 - Створення нової рослини (Мій новий Фікус) з прив'язкою до ID локації.

05:25 - Додавання нового ботанічного виду рослин (Троянда звичайна).

06:05 - Перегляд історії показників сенсорів (Readings).

06:26 - Робота з сенсорами: перегляд існуючих та реєстрація нового сенсора для нової рослини.

07:16 - Завершення звіту.





ДОДАТОК Б

Графічні матеріали


Рисунок 1 — ER-діаграма


Рисунок 2 — Діаграма бази даних

Рисунок 3 — UML діаграма прецедентів













ДОДАТОК В

Специфікація 

{
  "openapi": "3.0.0",
  "info": {
    "title": "EcoOffice API",
    "version": "1.0.0",
    "description": "API documentation for EcoOffice"
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/api/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password",
                  "fullName"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "user@eco.com"
                  },
                  "password": {
                    "type": "string",
                    "minLength": 6,
                    "example": "password123"
                  },
                  "fullName": {
                    "type": "string",
                    "example": "John Doe"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "ADMIN",
                      "OFFICE_MANAGER",
                      "FLORIST",
                      "CLEANER"
                    ],
                    "default": "CLEANER"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User successfully created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "token": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error or user already exists"
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "summary": "User login",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "user@eco.com"
                  },
                  "password": {
                    "type": "string",
                    "example": "password123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Successful login",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "user": {
                      "type": "object"
                    },
                    "token": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid email or password"
          }
        }
      }
    },
    "/api/backups": {
      "get": {
        "summary": "Get list of all backups on the server",
        "tags": [
          "Backups"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of backup files"
          }
        }
      },
      "post": {
        "summary": "Create a new database backup",
        "tags": [
          "Backups"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Backup created successfully"
          }
        }
      }
    },
    "/api/backups/download/{filename}": {
      "get": {
        "summary": "Download a backup file",
        "tags": [
          "Backups"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "filename",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Backup file download"
          }
        }
      }
    },
    "/api/backups/restore": {
      "post": {
        "summary": "Restore database from backup file",
        "description": " WARNING! This operation will overwrite the current database.",
        "tags": [
          "Backups"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Database restored successfully"
          }
        }
      }
    },
    "/api/logs": {
      "get": {
        "summary": "Get last 100 care log records",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of care logs"
          }
        }
      },
      "post": {
        "summary": "Complete a task (create care log entry)",
        "description": "**Simplified mode:** Provide only `taskId`\n(plantId and type will be resolved automatically).\n\n**Manual mode:** Provide `plantId` and `type`\n(when performing an action without a task).\n\n`performedByUserId` is taken automatically from the access token.\n",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "taskId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Task ID (recommended)"
                  },
                  "plantId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Plant ID (required if taskId is not provided)"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "WATERING",
                      "FERTILIZING",
                      "LIGHT_ADJUSTMENT",
                      "PEST_CONTROL",
                      "CLEANING"
                    ],
                    "description": "Action type (required if taskId is not provided)"
                  },
                  "notes": {
                    "type": "string"
                  },
                  "verifiedByScan": {
                    "type": "boolean"
                  },
                  "performedAt": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Care log created, task closed"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/logs/plant/{plantId}": {
      "get": {
        "summary": "Get care history for a specific plant",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "plantId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Plant care history"
          }
        }
      }
    },
    "/api/logs/{id}": {
      "get": {
        "summary": "Get care log record details",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Care log details"
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "put": {
        "summary": "Update care log record (ADMIN only)",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "notes": {
                    "type": "string"
                  },
                  "verifiedByScan": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete care log record (ADMIN only)",
        "tags": [
          "CareLogs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted successfully"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/locations": {
      "get": {
        "summary": "Get all locations",
        "description": "Returns a list of all office rooms and zones with related plants",
        "tags": [
          "Locations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of locations"
          }
        }
      },
      "post": {
        "summary": "Create a new location",
        "description": "Creates a new office room or zone (ADMIN and OFFICE_MANAGER only)",
        "tags": [
          "Locations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 2,
                    "example": "Open Space 1",
                    "description": "Name of the room or office zone"
                  },
                  "floorNumber": {
                    "type": "integer",
                    "example": 3,
                    "description": "Floor number where the location is situated"
                  },
                  "description": {
                    "type": "string",
                    "example": "Main relaxation area",
                    "description": "Additional description of the location"
                  },
                  "mapImageUrl": {
                    "type": "string",
                    "format": "uri",
                    "nullable": true,
                    "example": "https://example.com/maps/floor3.jpg",
                    "description": "URL to a map or floor plan image"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Location successfully created"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/locations/{id}": {
      "get": {
        "summary": "Get location details",
        "description": "Returns detailed information about a specific office location",
        "tags": [
          "Locations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Unique identifier of the location",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Location details"
          },
          "404": {
            "description": "Location not found"
          }
        }
      },
      "put": {
        "summary": "Update a location",
        "description": "Updates an existing office location (ADMIN and OFFICE_MANAGER only)",
        "tags": [
          "Locations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Unique identifier of the location",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 2,
                    "example": "Open Space 2",
                    "description": "Name of the room or office zone"
                  },
                  "floorNumber": {
                    "type": "integer",
                    "example": 4,
                    "description": "Floor number where the location is situated"
                  },
                  "description": {
                    "type": "string",
                    "example": "Updated meeting area",
                    "description": "Additional description of the location"
                  },
                  "mapImageUrl": {
                    "type": "string",
                    "format": "uri",
                    "nullable": true,
                    "example": "https://example.com/maps/floor4.jpg",
                    "description": "URL to a map or floor plan image"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Location successfully updated"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete a location",
        "description": "Deletes an office room or zone (ADMIN and OFFICE_MANAGER only)",
        "tags": [
          "Locations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Unique identifier of the location",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Location successfully deleted"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/species": {
      "get": {
        "summary": "Get all plant species",
        "tags": [
          "PlantSpecies"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of plant species"
          }
        }
      },
      "post": {
        "summary": "Create a new plant species (ADMIN, FLORIST)",
        "tags": [
          "PlantSpecies"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "scientificName",
                  "commonName",
                  "minSoilMoisture",
                  "maxSoilMoisture"
                ],
                "properties": {
                  "scientificName": {
                    "type": "string",
                    "example": "Ficus elastica"
                  },
                  "commonName": {
                    "type": "string",
                    "example": "Rubber Plant"
                  },
                  "minSoilMoisture": {
                    "type": "number",
                    "example": 30
                  },
                  "maxSoilMoisture": {
                    "type": "number",
                    "example": 60
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          },
          "403": {
            "description": "Forbidden (requires ADMIN or FLORIST role)"
          }
        }
      }
    },
    "/api/species/{id}": {
      "get": {
        "summary": "Get a plant species by ID",
        "tags": [
          "PlantSpecies"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Plant species details"
          },
          "404": {
            "description": "Not found"
          }
        }
      },
      "put": {
        "summary": "Update a plant species (ADMIN, FLORIST)",
        "tags": [
          "PlantSpecies"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "commonName": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete a plant species (ADMIN, FLORIST)",
        "tags": [
          "PlantSpecies"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Deleted"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/plants": {
      "get": {
        "summary": "Get all plants",
        "description": "Returns a list of all plants in the system",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of plants"
          }
        }
      },
      "post": {
        "summary": "Create a new plant",
        "description": "Adds a new plant (ADMIN and FLORIST only)",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "qrCodeId",
                  "speciesId"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "minLength": 2,
                    "example": "Office Ficus",
                    "description": "Custom plant name"
                  },
                  "qrCodeId": {
                    "type": "string",
                    "example": "QR-12345",
                    "description": "Unique QR code identifier"
                  },
                  "speciesId": {
                    "type": "string",
                    "format": "uuid",
                    "example": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11",
                    "description": "Plant species ID"
                  },
                  "locationId": {
                    "type": "string",
                    "format": "uuid",
                    "nullable": true,
                    "example": "b1eebc99-9c0b-4ef8-bb6d-6bb9bd380a22",
                    "description": "Location ID where the plant is placed"
                  },
                  "mapXCoordinate": {
                    "type": "integer",
                    "example": 100,
                    "description": "X coordinate on the location map"
                  },
                  "mapYCoordinate": {
                    "type": "integer",
                    "example": 200,
                    "description": "Y coordinate on the location map"
                  },
                  "photoUrl": {
                    "type": "string",
                    "format": "uri",
                    "nullable": true,
                    "example": "https://example.com/plant.jpg",
                    "description": "URL of the plant photo"
                  },
                  "healthStatus": {
                    "type": "string",
                    "enum": [
                      "HEALTHY",
                      "NEEDS_ATTENTION",
                      "CRITICAL"
                    ],
                    "example": "HEALTHY",
                    "description": "Current health status of the plant"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Plant successfully created"
          },
          "403": {
            "description": "Insufficient permissions"
          }
        }
      }
    },
    "/api/plants/floor/{floorNumber}": {
      "get": {
        "summary": "Get plants by floor number",
        "description": "Returns all plants located on a specific floor",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "floorNumber",
            "required": true,
            "description": "Floor number",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of plants on the floor"
          }
        }
      }
    },
    "/api/plants/location/{locationId}": {
      "get": {
        "summary": "Get plants by location",
        "description": "Returns all plants located in a specific office room or zone",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "locationId",
            "required": true,
            "description": "Location ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of plants in the location"
          }
        }
      }
    },
    "/api/plants/{id}/sensors": {
      "get": {
        "summary": "Get sensors attached to a plant",
        "description": "Returns all sensors connected to the specified plant",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Plant ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of plant sensors"
          },
          "404": {
            "description": "Plant not found"
          }
        }
      }
    },
    "/api/plants/{id}/readings": {
      "get": {
        "summary": "Get latest sensor readings",
        "description": "Returns plant sensors with the latest 5 readings for each sensor",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Plant ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sensor readings with history"
          },
          "404": {
            "description": "Plant not found"
          }
        }
      }
    },
    "/api/plants/{id}": {
      "get": {
        "summary": "Get plant details",
        "description": "Returns detailed information about a specific plant",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Plant ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Plant details"
          },
          "404": {
            "description": "Plant not found"
          }
        }
      },
      "put": {
        "summary": "Update a plant",
        "description": "Updates plant information (ADMIN and FLORIST only)",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Plant ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "Updated Ficus"
                  },
                  "qrCodeId": {
                    "type": "string",
                    "example": "QR-98765"
                  },
                  "speciesId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "locationId": {
                    "type": "string",
                    "format": "uuid",
                    "nullable": true
                  },
                  "mapXCoordinate": {
                    "type": "integer"
                  },
                  "mapYCoordinate": {
                    "type": "integer"
                  },
                  "photoUrl": {
                    "type": "string",
                    "format": "uri",
                    "nullable": true
                  },
                  "healthStatus": {
                    "type": "string",
                    "enum": [
                      "HEALTHY",
                      "NEEDS_ATTENTION",
                      "CRITICAL"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Plant successfully updated"
          },
          "403": {
            "description": "Insufficient permissions"
          }
        }
      },
      "delete": {
        "summary": "Delete a plant",
        "description": "Removes a plant from the system (ADMIN and FLORIST only)",
        "tags": [
          "Plants"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Plant ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Plant successfully deleted"
          },
          "403": {
            "description": "Insufficient permissions"
          }
        }
      }
    },
    "/api/readings": {
      "get": {
        "summary": "Get latest 100 readings",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of readings"
          }
        }
      },
      "post": {
        "summary": "Create a reading manually (ADMIN only)",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "sensorId",
                  "type",
                  "value"
                ],
                "properties": {
                  "sensorId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Existing sensor ID",
                    "example": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "SOIL_MOISTURE",
                      "AIR_TEMPERATURE",
                      "AIR_HUMIDITY",
                      "LIGHT_INTENSITY",
                      "BATTERY_LEVEL"
                    ],
                    "example": "SOIL_MOISTURE"
                  },
                  "value": {
                    "type": "number",
                    "description": "Numeric sensor value",
                    "example": 45.5
                  },
                  "recordedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Optional reading timestamp"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Reading created"
          },
          "403": {
            "description": "Forbidden (ADMIN only)"
          }
        }
      }
    },
    "/api/readings/iot": {
      "post": {
        "summary": "Receive sensor readings from IoT bridge using device MAC address",
        "description": "Endpoint for receiving telemetry data from IoT devices. The device is identified by its MAC address.\n",
        "tags": [
          "Readings"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateIoTReadingRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Sensor reading successfully saved"
          },
          "400": {
            "description": "Invalid request payload"
          },
          "404": {
            "description": "IoT device is not registered in the system"
          }
        }
      }
    },
    "/api/readings/sensor/{sensorId}": {
      "get": {
        "summary": "Get readings for a specific sensor",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "sensorId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sensor readings history"
          }
        }
      }
    },
    "/api/readings/{id}": {
      "get": {
        "summary": "Get a reading by ID",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Reading details"
          },
          "404": {
            "description": "Reading not found"
          }
        }
      },
      "put": {
        "summary": "Update a reading (ADMIN only)",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "value": {
                    "type": "number"
                  },
                  "recordedAt": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reading updated"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete an invalid reading (ADMIN only)",
        "tags": [
          "Readings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Reading deleted"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/sensors": {
      "get": {
        "summary": "Get all sensors",
        "tags": [
          "Sensors"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of sensors"
          }
        }
      },
      "post": {
        "summary": "Create a new sensor (ADMIN only)",
        "tags": [
          "Sensors"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "macAddress"
                ],
                "properties": {
                  "macAddress": {
                    "type": "string",
                    "description": "Unique MAC address",
                    "example": "AA:BB:CC:11:22:33"
                  },
                  "plantId": {
                    "type": "string",
                    "format": "uuid",
                    "description": "Plant ID to assign the sensor",
                    "example": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"
                  },
                  "sensorModel": {
                    "type": "string",
                    "example": "ESP32-Soil-V2"
                  },
                  "firmwareVersion": {
                    "type": "string",
                    "example": "1.0.0"
                  },
                  "isActive": {
                    "type": "boolean",
                    "default": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Sensor created"
          },
          "400": {
            "description": "Sensor with this MAC address already exists"
          },
          "403": {
            "description": "Forbidden (ADMIN only)"
          }
        }
      }
    },
    "/api/sensors/{id}": {
      "get": {
        "summary": "Get sensor by ID",
        "tags": [
          "Sensors"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sensor details"
          },
          "404": {
            "description": "Sensor not found"
          }
        }
      },
      "put": {
        "summary": "Update sensor data (ADMIN only)",
        "tags": [
          "Sensors"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "plantId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "isActive": {
                    "type": "boolean"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sensor updated"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete sensor (ADMIN only)",
        "tags": [
          "Sensors"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Sensor deleted"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/stats": {
      "get": {
        "summary": "Get system overview statistics",
        "tags": [
          "Stats"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Dashboard data"
          }
        }
      }
    },
    "/api/tasks": {
      "get": {
        "summary": "Get all tasks",
        "description": "ADMIN and FLORIST can see all tasks; other roles see tasks assigned to their role",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of tasks"
          }
        }
      },
      "post": {
        "summary": "Create a new task",
        "description": "Creates a new task (ADMIN and FLORIST only)",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "plantId",
                  "requiredRole",
                  "type"
                ],
                "properties": {
                  "plantId": {
                    "type": "string",
                    "format": "uuid",
                    "example": "a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11",
                    "description": "Plant ID related to this task"
                  },
                  "requiredRole": {
                    "type": "string",
                    "enum": [
                      "ADMIN",
                      "OFFICE_MANAGER",
                      "FLORIST",
                      "CLEANER"
                    ],
                    "example": "CLEANER",
                    "description": "Role responsible for executing the task"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "WATERING",
                      "FERTILIZING",
                      "LIGHT_ADJUSTMENT",
                      "PEST_CONTROL",
                      "CLEANING"
                    ],
                    "example": "WATERING",
                    "description": "Task type"
                  },
                  "priority": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 3,
                    "example": 2,
                    "description": "Task priority (1 = Normal, 3 = Urgent)"
                  },
                  "description": {
                    "type": "string",
                    "example": "Water the plant with 200ml of water",
                    "description": "Task instructions or notes"
                  },
                  "dueDate": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2025-12-07T10:00:00Z",
                    "description": "Task deadline"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Task successfully created"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/tasks/{id}": {
      "get": {
        "summary": "Get task details",
        "description": "Returns detailed information about a specific task",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Task ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Task details"
          },
          "404": {
            "description": "Task not found"
          }
        }
      },
      "put": {
        "summary": "Update task details",
        "description": "Updates task information (ADMIN and FLORIST only)",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Task ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "plantId": {
                    "type": "string",
                    "format": "uuid"
                  },
                  "requiredRole": {
                    "type": "string",
                    "enum": [
                      "ADMIN",
                      "OFFICE_MANAGER",
                      "FLORIST",
                      "CLEANER"
                    ]
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "WATERING",
                      "FERTILIZING",
                      "LIGHT_ADJUSTMENT",
                      "PEST_CONTROL",
                      "CLEANING"
                    ]
                  },
                  "priority": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 3
                  },
                  "description": {
                    "type": "string"
                  },
                  "dueDate": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Task successfully updated"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      },
      "delete": {
        "summary": "Delete a task",
        "description": "Deletes a task (ADMIN and FLORIST only)",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Task ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Task successfully deleted"
          },
          "403": {
            "description": "Forbidden"
          }
        }
      }
    },
    "/api/tasks/{id}/status": {
      "patch": {
        "summary": "Update task status",
        "description": "Accessible by ADMIN, FLORIST, or the assigned executor role",
        "tags": [
          "Tasks"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "description": "Task ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "PENDING",
                      "IN_PROGRESS",
                      "COMPLETED",
                      "CANCELLED",
                      "SKIPPED"
                    ],
                    "example": "COMPLETED",
                    "description": "New task status"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Task status successfully updated"
          },
          "403": {
            "description": "You do not have permission to update this task"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Auth",
      "description": "User management (registration and login)"
    },
    {
      "name": "Backups",
      "description": "Database backup management (Admin only)"
    },
    {
      "name": "CareLogs",
      "description": "Plant care activity logs (history)"
    },
    {
      "name": "Locations",
      "description": "Office rooms and zones management"
    },
    {
      "name": "PlantSpecies",
      "description": "Plant species directory"
    },
    {
      "name": "Plants",
      "description": "Plant management"
    },
    {
      "name": "Readings",
      "description": "Sensor readings (temperature, humidity, etc.)"
    },
    {
      "name": "Sensors",
      "description": "IoT sensor management"
    },
    {
      "name": "Stats",
      "description": "System statistics and analytics (Admin/Florist)"
    },
    {
      "name": "Tasks",
      "description": "Task planning and queue management"
    }
  ]
}

2


